<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>webpack-minimal</title>
    <link rel="shortcut icon" type="image/png" href="../assets/favicon-16x16.png"/>
    <!-- <link rel="stylesheet" href="./src/index.css"/>
         <link rel="stylesheet" href="./src/theme.css"/> -->
    <link rel="stylesheet" href="./assets/cards-css/pixel.css"/>
    <link href="https://unpkg.com/ionicons@4.5.5/dist/css/ionicons.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css?family=Roboto&display=swap" rel="stylesheet">
    <style>
          html, body {
         width: 100%;
         height: 100%;
         padding: 0px;
         margin: 0px;

     }

     body {
         font-family: 'Roboto', sans-serif;
         background: black;
     }

     section {
         width: 100%;
         height: 100%;
         background: #202020;
     }

     #controls {
         text-align: center;
     }

     .pg-wrap {
         margin: auto;
         width: 90%;
         height: 0;
         padding-bottom: 60%;
     }
    </style>
</head>
<body>
<section>
  <div id="app"></div>

  <div id="controls">
    <button id="deal">Deal</button>
    <button id="round">Next Round</button>
    <button id="showdown">Showdown</button>
    <button id="check">Check</button>
    <button id="call">Call</button>
    <button id="raise">Raise</button>
    <button id="allin">AllIn</button>
    <button id="fold">Fold</button>
  </div>
</section>

<script>

const promiseSerial = funcs =>
  funcs.reduce((promise, func) =>
    promise.then(result => func().then(Array.prototype.concat.bind(result))),
    Promise.resolve([]))

 const api = init();

 function init() {
 
   const handlers = {
     move(o) {
     }
   };

   var config = {
     round: 'preflop',
     deal: {
       blinds: 100,
       button: 0,
       smallBlind: 1,
       bigBlind: 4,
       firstToAct: 0
     },
     currency: '$',
     pov: {
       seats: [{img: 'https://i.pravatar.cc/300', stack: 10000},
               { img: 'https://i.pravatar.cc/300', stack: 900 },
               null,
               null, 
               { img: 'https://i.pravatar.cc/300', stack: 120399}]
     },
     events: {
     }
   };

   //const server = new Pokerground.Server();
   //const socket = new Pokerground.Socket(handlers);

   const api = Pokerground(document.getElementById('app'), config);

   return api;
 }

 var seatIndexes = [0,1,4];
 
 onClick(document.getElementById("deal"), (() => {
   var nextIndex = (from) => {
     return seatIndexes[
       (seatIndexes.indexOf(from) + 1) % seatIndexes.length];
   };
   var button = seatIndexes[0];
   return function() {
     var o = {
       blinds: 100,
       button: button,
       smallBlind: nextIndex(button),
       bigBlind: nextIndex(nextIndex(button)),
       firstToAct: nextIndex(nextIndex(nextIndex(button)))
     };
     api.deal(o);
     button = nextIndex(button);
   }
 })());

 onClick(document.getElementById("showdown"), (() => {
   var showdown = {
     middle: {
       flop: 'As Tc Qd',
       turn: 'Kh',
       river: '2c'
     },
     hands: {
       [seatIndexes[0]]: { hole: 'Ah Ac', rank: 'threepair', hand: 'Ah Ac As Qd Tc' },
       [seatIndexes[1]]: { hole: 'Kc Jh', rank: 'straight', hand: 'As Kh Qd Jh Tc' },
       [seatIndexes[2]]: { hole: '2c 3c', rank: 'highcard', hand: 'As Qd Tc 3c 2c' }
     },
     pots: [
       { amount: 1500, involved: [seatIndexes[1]]},
       { amount: 5000, involved: [seatIndexes[0], seatIndexes[2], seatIndexes[1]]},
       { amount: 1500, involved: [seatIndexes[1]]},
       { amount: 1500, involved: [seatIndexes[2]]},
       { amount: 1500, involved: [seatIndexes[0]]},
       { amount: 5000, involved: [seatIndexes[0], seatIndexes[2]]}],
     pot: 16000
   };
   return function() {
     api.showdown(showdown);
   };
 })());

 onClick(document.getElementById("round"), (() => {
   var pot = 0;
   var middle = {};
   return function() {
     pot += 3250;
     var reset;
     if (middle.river) {
       middle = {};
       reset = true;
     }
     if (middle.turn) {
       middle.river = '2c'
     }
     if (middle.flop) {
       middle.turn = 'Kh'
     }
     if (!reset && !middle.flop) {
       middle.flop = 'As Tc Qd';
     }
     api.nextRound({ middle, pot});
   };
 })());

 onClick(document.getElementById("raise"), () => api.raise(10000));

 onClick(document.getElementById("call"), () => api.call(1000));

 onClick(document.getElementById("allin"), () => api.allin(10000));

 onClick(document.getElementById("check"), () => api.check());

 onClick(document.getElementById("fold"), () => api.fold());

 function onClick(button, f) {
   button.addEventListener('click', f);
 }
 
</script>

</body>
</html>
